<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>BestBois - Categories</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
</head>
<body>
<div class="container-flex mb-4 p-3 bg-success row align-items-center mx-0">
    <div class="col-md-9">
        <h1 class="display-3 text-light"><a th:href="@{/categories}" class="link-light">BestBois</a></h1>
    </div>
    <div class="col-md-3">
        <a th:if="${authorized}" th:href="@{/settings}" class="btn btn-outline-light p-2">Settings</a>
        <a th:if="${authorized}" th:href="@{/login(logout=true)}" class="btn btn-outline-light p-2">Sign Out</a>
        <a th:if="!${authorized}" th:href="@{/login}"  class="btn btn-outline-light p-2">Login/Register</a>
    </div>
</div>
<nav>
    <ul class = "pagination" th:with="total = ${itemPage.totalPages}">
        <li th:if="${itemPage.hasPrevious()}">
            <a
                    th:href="@{${uri.toString()}(page=${itemPage.previousPageable().pageNumber},size=${itemPage.size},categoryid=${param.categoryid})}"
                    aria-label="Previous"
            >
                <span aria-hidden="true">&lt;</span>
            </a>
        </li>
        <li
                th:each="category : ${#numbers.sequence(0, total - 1)}">
            <a
                    th:href="@{${uri.toString()}(page=${category},size=${itemPage.size},categoryid=${param.categoryid})}"
                    th:text="${category + 1}"
            >1</a></li>
        <li th:if="${itemPage.hasNext()}">
            <a
                    th:href="@{${uri.toString()}(page=${itemPage.nextPageable().pageNumber},size=${itemPage.size},categoryid=${param.categoryid})}"
                    aria-label="Next"
            >
                <span aria-hidden="true">&gt;</span>
            </a>
        </li>
    </ul>
    <div th:with="total = ${itemPage.totalPages}"  th:each="id : ${itemPage}">
        <!--/*@thymesVar id="item" type="spring.model.ItemModel"*/-->
        <div th:with="item = ${itemMap.get(id)}">
            <form th:action="@{/shoppingCart(categoryid=${param.categoryid}, itemid = ${item.getUuid()})}" th:object="${cartModificationForm}" method = "post">
                <div th:if="${viewType!=null && viewType.equalsIgnoreCase('employee') || viewType.equalsIgnoreCase('manager')}">
                    <h3 th:text="${item.getName()}">Item Name</h3>
                    <label>Price</label>
                    <input type="number" pattern="^\d*(\.\d{0,2})?$" step="0.01" min="0" th:field="*{price}" required th:placeholder="${item.getPrice()}">
                    <label>Quantity</label>
                    <input type="number" th:field="*{quantity}" min="0" required th:placeholder="${item.getQuantity()}">
                    <button type="submit">Modify Item</button>
                </div>
                <div th:if="!${viewType!=null && viewType.equalsIgnoreCase('employee') || viewType.equalsIgnoreCase('manager')}">
                    <h3 th:text="${item.getName() + ' x ' + item.getQuantity() + ' - $' + item.getPrice()}">Item</h3>

                    <h6 th:text="${item.getDescription()}">Item Description</h6>
                    <!--/*@thymesVar id="cart" type="spring.model.ShoppingCartInfo"*/-->

                    <input type="hidden" th:value="${item.getUuid()}" th:field="*{item_id}" required>
                    <input th:field="*{quantity}"
                           type="number"
                           value="1"
                           required
                           th:max="${item.getQuantity()}"
                           min=1
                           th:placeholder="${cart.getOrder(item.getUuid()).quantity}"
                           th:default="1"
                    >
                    <button th:if="!${cart.hasOrder(item.getUuid())}" type="submit">Add To Cart</button>
                    <button th:if="${cart.hasOrder(item.getUuid())}" type="submit">Update Cart</button>
                </div>
            </form>
        </div>
    </div>

    <!--/*@thymesVar id="viewType" type="java.lang.String"*/-->
    <div th:if="${viewType!=null && viewType.equalsIgnoreCase('employee') || viewType.equalsIgnoreCase('manager')}">
        <h1>Only Employees/Managers can see this message.</h1>
        <h2>Submit New Items to this Category</h2>
        <!--/*@thymesVar id="itemSubmissionForm" type="spring.form.ItemSubmissionForm"*/-->
        <form th:action="@{/item(categoryid=${param.categoryid})}" th:object="${itemSubmissionForm}" method="post">
            <label>Name</label>
            <input type="text" th:field="*{name}" required th:placeholder="${itemSubmissionForm.name}">
            <label>Description</label>
            <input type="text" th:field="*{description}" required th:placeholder="${itemSubmissionForm.description}">
            <label>Price</label>
            <input type="number" pattern="^\d*(\.\d{0,2})?$" step="0.01" min="0" th:field="*{price}" required th:placeholder="${itemSubmissionForm.price}">
            <label>Quantity</label>
            <input type="number" th:field="*{stock}" required th:placeholder="${itemSubmissionForm.stock}">
            <button type="submit">Add Item</button>
        </form>
    </div>
</nav>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>
</body>
</html>